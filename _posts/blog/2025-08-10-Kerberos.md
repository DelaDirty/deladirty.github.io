---
title: "Kerberos Delegations: What is it?"
date: 2025-08-10                  
categories:
 - blog                          
tags:
 - ctf
 - Active Directory
 - pentesting
 - RedTeaming
layout: single
excerpt: "This post explains what Kerberos Delegations are how each type works and why they're exploitable."
author_profile: true
header:
  teaser: /assets/images/blog/kerberos/cerb.png
toc: true
---

<img src="/assets/images/blog/kerberos/cerb.png"
     alt= "From Chaos to Clarity: Why Templates Are Essential"
     class= "align-center"      
     style="max-width: 600px;" />


# What are Kerberos Delegations?  

Kerberos Delegation is a feature in Active Directory that allows a service you connect to essentially vouch for you when it needs to access another service. Instead of you as a user having to log in to multiple areas, the first service can act as if it were you, using your identity to request other resources.  

 A good and common example is a web server that needs to pull data from a database on your behalf. Instead of giving the web server its own broad permissions, Kerberos Delegation lets it request access to the database using your credentials. The database will then return only what your account is authorized to see, without granting unrestricted access to the web server.

There are different types of Kerberos delegations, and each has its own security levels and issues.

---

## The 3 main types

1. **Unconstrained Delegation**

This one is the oldest type and least secure. It allows a service to impersonate a user to **any** other service in the domain after a user authenticates to it. This is why it is considered the least secure.  

When a user connects, the Domain Controller doesn't just give the service a service ticket; it also gives the user's Ticket Granting Ticket (TGT) in memory. This TGT can be reused to access any resource the user has permissions for, not just what was initially requested.  

In other words, the service is granted **Full Trust** with virtually no limitations. Our limitations are based on the user's permissions. However, if an attacker compromises a system with Unconstrained Delegations enabled and captures a TGT of a privileged account, they can connect to nearly any service in the domain.


<img src="/assets/images/blog/kerberos/UCD.jpg"
     alt= "From Chaos to Clarity: Why Templates Are Essential"
     class= "align-center"      
     style="max-width: 600px;" />

---

2. **Constrained Delegation**

Constrained Delegation was introduced to provide a safer form of Delegation and address the security risk of Unconstrained Delegation. Instead of allowing a service to act on behalf of a user to **any** other service, its abilities are limited to a defined list of services. 

When a user connects, the Domain Controller gives the initial service a service ticket for itself, but it does **not** get the user's full TGT. If that service later needs to access another service on the user's behalf, it first uses S4U2Self to obtain a service ticket in the user's name. It then uses *S4U2Proxy* to present that ticket to one of the specific target services defined in Active Directory.

---

3. **Resource-Based Constrained Delegation**

Resource-Based Constrained Delegation (RBCD) is the newest form of Kerberos delegation and works in the opposite way of traditional Constrained Delegation. Instead of the initiating service deciding where it can delegate, the resource decides which accounts are trusted to act on behalf of users. In most environments, these trusted accounts are machine accounts or service accounts, not regular user accounts. The configuration is stored in the msDS-AllowedToActOnBehalfOfOtherIdentity attribute on the resource's computer object in Active Directory.

Once this trust is in place, a controlled machine or service account can request and use Kerberos tickets to access that resource as any chosen user. This process does not use the S4U2Self and S4U2Proxy flow from Constrained Delegation. Instead, it relies on being able to obtain and manipulate tickets after the AllowedToAct relationship has been set.

RBCD gives the resource owner more control and follows the principle of least privilege, but it can still be abused. If an attacker can modify the delegation attribute on a resource, they can grant their own machine or service account the ability to impersonate any user to that resource.

---

# Risk Factors and Exploitation

**Unconstrained Delegation**

*Risk:* User's full TGT is stored in memory, allowing impersonation to any service the user can access.

*Exploitation:* An Attacker who gains access to a system with an Unconstrained delegation-enabled can force privileged accounts to authenticate to it, then extract cached TGTs from memory. Tools such as Rubeus can be used.

---

**Constrained Delegation**

*Risk:* Limits delegation to specific services, but those services might still be highly privileged.

*Exploitation:* After compromising a service with Constrained Delegation, attackers can use Kerberos ticket manipulation to impersonate a user to an allowed service listed in its delegation settings. Tools such as Rubeus are commonly used to perform *S4USelf* and *S4U2Proxy*.

---

**Resource-Based Constrained Delegation (RBCD)**

*Risk:* It is more granular, but if an attacker can modify the `msDS-AllowedToActOnBehalfOfOtherIdentity` attribute on a resource's computer object, they can give their own machine or service account the ability to impersonate users to that resource.

*Exploitation:* After establishing this trust between two resources, the attacker can use Rubeus to request and manipulate Kerberos tickets without relying on S4U2Self or S4U2Proxy. Rubeus can dump the necessary tickets from the controlled machine/service account and then leverage alternate service tickets to gain access to the target system. The key abuse point is the ability to request tickets for privileged accounts to the target resource once the AllowedToAct relationship is in place.